<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR Tour Di T√≠ch U Minh</title>
    <meta name="description" content="360&deg; Tour - A-Frame" />

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/js/aframe.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-orbit-controls-component@1.1.0/dist/aframe-orbit-controls-component.min.js"></script>
    <script src="assets/js/tour.js"></script>
    <script src="assets/js/hotspot.js"></script>
    <script src="assets/js/panorama.js"></script>
  </head>
  <body>
    <!-- üåÑ MODAL GI·ªöI THI·ªÜU -->
    <div
      id="intro-modal"
      class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-md transition-all duration-500"
    >
      <!-- Background -->
      <div
        class="absolute inset-0 bg-cover bg-center"
        style="
          background-image: url('assets/image/cong_truoc/home.jpg');
          filter: brightness(0.6);
        "
      ></div>

      <!-- N·ªôi dung -->
      <div
        class="relative z-10 text-center text-white px-6 py-10 md:px-12 lg:px-24 max-w-3xl"
      >
        <h1
          class="text-3xl md:text-4xl font-extrabold mb-6 drop-shadow-lg uppercase tracking-wide"
        >
          AR TOUR DI T√çCH U MINH
        </h1>

        <p class="text-lg md:text-xl mb-4 font-light">
          <span class="font-semibold">C√¥ng tr√¨nh thanh ni√™n</span> Ch√†o m·ª´ng
          th√†nh c√¥ng ƒê·∫°i h·ªôi ƒë·∫°i bi·ªÉu ƒêo√†n Thanh ni√™n C·ªông s·∫£n H·ªì Ch√≠ Minh
          Ph∆∞·ªùng H∆∞ng Ph√∫ l·∫ßn th·ª© I, nhi·ªám k·ª≥ 2025 - 2030.
        </p>

        <p class="text-base md:text-lg mb-8 text-gray-300">
          <span class="font-semibold">ƒê∆°n v·ªã th·ª±c hi·ªán:</span> ƒêo√†n Thanh ni√™n
          C·ªông s·∫£n H·ªì Ch√≠ Minh Ph∆∞·ªùng H∆∞ng Ph√∫
        </p>

        <button
          id="start-tour-btn"
          class="mt-6 bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white text-lg md:text-xl font-semibold py-3 px-8 rounded-full shadow-lg transition-all duration-300"
        >
          üöÄ B·∫Øt ƒë·∫ßu tham quan
        </button>
      </div>
    </div>

    <!-- üñºÔ∏è N√∫t m·ªü gallery ·∫£nh -->
    <!-- üñºÔ∏è N√∫t m·ªü gallery ·∫£nh (ƒë·∫∑t c·∫°nh n√∫t √¢m thanh) -->
    <button
      id="open-gallery-btn"
      class="fixed top-4 right-20 z-40 bg-green-600 hover:bg-green-700 text-white p-3 rounded-full shadow-lg transition-all duration-300 flex items-center justify-center"
      title="Xem h√¨nh ·∫£nh t∆∞ li·ªáu"
    >
      <img src="assets/image/icon/gallery.svg" alt="icon" class="h-6 w-6" />
    </button>

    <!-- üìñ Modal hi·ªÉn th·ªã gallery -->
    <div
      id="gallery-modal"
      class="fixed inset-0 z-50 hidden items-center justify-center bg-black/90 backdrop-blur-md transition-all duration-500"
    >
      <div class="relative w-full max-w-5xl mx-auto px-4">
        <!-- N√∫t ƒë√≥ng -->
        <button
          id="close-gallery-btn"
          class="absolute top-3 right-3 z-50 bg-white/20 hover:bg-white/30 text-white rounded-full p-2 transition-all h-12 w-12"
          title="ƒê√≥ng"
        >
          ‚úï
        </button>

        <!-- ·∫¢nh hi·ªÉn th·ªã -->
        <div class="relative flex justify-center items-center">
          <img
            id="gallery-image"
            src=""
            alt="H√¨nh ·∫£nh t∆∞ li·ªáu"
            class="max-h-[80vh] w-auto rounded-xl shadow-lg object-contain transition-all duration-300"
          />
        </div>

        <!-- N√∫t chuy·ªÉn ·∫£nh -->
        <div
          class="absolute inset-x-0 top-1/2 flex justify-between items-center px-6"
        >
          <button
            id="prev-image"
            class="bg-white/20 hover:bg-white/40 text-white text-3xl font-bold w-12 h-12 rounded-full flex justify-center items-center"
          >
            ‚Äπ
          </button>
          <button
            id="next-image"
            class="bg-white/20 hover:bg-white/40 text-white text-3xl font-bold w-12 h-12 rounded-full flex justify-center items-center"
          >
            ‚Ä∫
          </button>
        </div>

        <!-- Ch·ªâ s·ªë ·∫£nh -->
        <div class="text-center mt-4 text-white text-sm md:text-base">
          <span id="gallery-counter"></span>
        </div>
      </div>
    </div>

    <button
      id="narration-btn"
      class="fixed top-4 right-36 z-40 bg-orange-600 hover:bg-orange-700 text-white p-3 rounded-full shadow-lg transition-all duration-300 flex items-center justify-center"
      title="Ph√°t / T·∫°m d·ª´ng thuy·∫øt minh"
    >
      <!-- ‚ñ∂Ô∏è Icon ph√°t -->
      <svg
        id="narration-icon-play"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="2"
        stroke="currentColor"
        class="w-6 h-6 block"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M8 5v14l11-7-11-7z"
        />
      </svg>

      <!-- ‚è∏ Icon t·∫°m d·ª´ng -->
      <svg
        id="narration-icon-pause"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="2"
        stroke="currentColor"
        class="w-6 h-6 hidden"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M10 9v6m4-6v6m-9 8h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2z"
        />
      </svg>
    </button>

    <!-- üéß Thanh audio player -->
    <div
      id="narration-player"
      class="hidden fixed bottom-6 left-1/2 -translate-x-1/2 bg-black/70 backdrop-blur-md rounded-xl px-4 py-2 shadow-lg flex items-center justify-center w-[90%] max-w-md z-50"
    >
      <audio id="narration-audio" controls class="w-full">
        <source src="assets/audio/offvoice_uminh.mp3" type="audio/mpeg" />
        Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ph√°t √¢m thanh.
      </audio>
    </div>

    <button
      id="sound-toggle"
      class="fixed top-4 right-4 z-40 bg-black/60 text-white p-3 rounded-full shadow-lg hover:bg-black/80 transition-all duration-300 flex items-center justify-center"
      title="B·∫≠t / T·∫Øt √¢m thanh"
    >
      <svg
        id="sound-icon-on"
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6 block"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 9v6h4l5 5V4l-5 5H9z"
        />
      </svg>
      <svg
        id="sound-icon-off"
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6 hidden"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 9v6h4l5 5V4l-5 5H9zM19 5L5 19"
        />
      </svg>
    </button>

    <audio id="audio-phong_tho" src="assets/audio/audio1.mp3" loop></audio>
    <audio id="audio-gian_truoc" src="assets/audio/audio2.mp3" loop></audio>
    <audio
      id="audio-phong_truyen_thong"
      src="assets/audio/audio3.mp3"
      loop
    ></audio>

    <a-scene>
      <a-assets>
        <a-mixin
          id="hotspot-text"
          text="font: exo2bold; width: 5"
          geometry="primitive: plane; width: 1.6; height: 0.4"
          material="color: black;"
          position="0 -0.6 0"
        ></a-mixin>
        <a-mixin
          id="hotspot-target"
          geometry="primitive: octahedron; radius: 0.3;"
          material="flatShading: true; color: rgb(255, 0, 161)"
        ></a-mixin>
      </a-assets>
      <a-tour hotspot-helper="target: #test">
        <!-- Panorama 1 -->
        <!-- id="khleang-pagoda" -->
        <a-panorama
          id="gian_truoc_1"
          src="assets/image/gian_truoc/1.jpg"
          rotation="0 0 0"
        >
        </a-panorama>
        <a-panorama
          id="gian_truoc_2"
          src="assets/image/gian_truoc/2.jpg"
          rotation="0 0 0"
        >
        </a-panorama>
        <a-panorama
          id="gian_truoc_3"
          src="assets/image/gian_truoc/5.jpg"
          rotation="0 0 0"
        >
        </a-panorama>
        <a-panorama
          id="gian_truoc_4"
          src="assets/image/gian_truoc/4.jpg"
          rotation="0 0 0"
        >
        </a-panorama>
        <a-panorama
          id="gian_truoc_5"
          src="assets/image/gian_truoc/3.jpg"
          rotation="0 0 0"
        >
        </a-panorama>
        <a-panorama
          id="gian_truoc_6"
          src="assets/image/gian_truoc/6.jpg"
          rotation="0 0 0"
        >
        </a-panorama>

        <!-- Ph√≤ng truy·ªÅn th·ªëng -->
        <a-panorama
          id="phong_truyen_thong"
          src="assets/image/phong_truyen_thong/1.jpg"
          rotation="0 0 0"
        >
        </a-panorama>

        <!-- Ph√≤ng th·ªù -->
        <a-panorama
          id="phong_tho"
          src="assets/image/gian_tho/1.jpg"
          rotation="0 0 0"
        >
        </a-panorama>

        <a-panorama
          id="phong_tho_2"
          src="assets/image/gian_tho/2.jpg"
          rotation="0 0 0"
        >
        </a-panorama>

        <a-panorama
          id="phong_tho_3"
          src="assets/image/gian_tho/4.jpg"
          rotation="0 0 0"
        >
        </a-panorama>

        <a-panorama
          id="phong_tho_4"
          src="assets/image/gian_tho/5.jpg"
          rotation="0 0 0"
        >
        </a-panorama>

        <!-- Hotspots -->
        <!-- From Panorama 1 to 2 -->
        <a-hotspot
          for="gian_truoc_1"
          to="phong_truyen_thong"
          position="-3 -4 -8"
          rotation="0 20 0"
          visible="true"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 180 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="gian_truoc_1"
          to="gian_truoc_2"
          position="3 -4 8"
          rotation="0 200 0"
          visible="true"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 180 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="gian_truoc_2"
          to="gian_truoc_1"
          position="3 -6 8"
          rotation="0 -175 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 180 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="gian_truoc_2"
          to="gian_truoc_3"
          position="0 -4 -8"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 180 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="gian_truoc_3"
          to="gian_truoc_2"
          position="-1 -4 -8"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 180 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="gian_truoc_2"
          to="phong_tho"
          position="-7 -2 1"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 -90 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_tho"
          to="gian_truoc_2"
          position="10 -3 0"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 90 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_tho"
          to="phong_tho_2"
          position="-5 -5 0"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 -90 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_tho"
          to="phong_tho_3"
          position="0 -5 5"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 0 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_tho_3"
          to="phong_tho"
          position="-2 -5 -5"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 190 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_tho"
          to="phong_tho_4"
          position="0 -5 -5"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 180 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_tho_4"
          to="phong_tho"
          position="0 -5 5"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 0 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_tho_2"
          to="phong_tho"
          position="10 -5 0"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 90 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_truyen_thong"
          to="gian_truoc_1"
          position="2 -3 -8"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 180 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>
      </a-tour>

      <!-- <a-entity
        gltf-model="assets/models/sample.glb"
        position="0 -2 -5"
        scale="1 1 1"
        rotation="0 180 0"
        animation="property: rotation; from: 0 180 0; to: 0 540 0; loop: true; dur: 10000; easing: linear"
      >
      </a-entity> -->

      <a-entity camera look-controls wasd-controls rotation="0 45 0">
        <a-entity
          cursor
          position="0 0 -1"
          geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
          material="color: black; shader: flat"
        >
        </a-entity>
      </a-entity>
    </a-scene>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const modal = document.getElementById("intro-modal");
        const startBtn = document.getElementById("start-tour-btn");
        const soundBtn = document.getElementById("sound-toggle");
        const soundOn = document.getElementById("sound-icon-on");
        const soundOff = document.getElementById("sound-icon-off");

        const audioGeneral = new Audio("assets/audio/audio.mp3");
        audioGeneral.loop = true;

        const narrationPlayer = document.getElementById("narration-player");
        const narrationAudio = document.getElementById("narration-audio");
        const narrationBtn = document.getElementById("narration-btn");
        const narrationIconPlay = document.getElementById(
          "narration-icon-play"
        );
        const narrationIconPause = document.getElementById(
          "narration-icon-pause"
        );

        let currentAudio = null;
        let soundEnabled = true;

        // üöÄ Khi b·∫•m "B·∫Øt ƒë·∫ßu tham quan" ‚Üí v√†o PH√íNG TH·ªú v√† t·ª± ph√°t offvoice
        startBtn.addEventListener("click", () => {
          modal.classList.add("opacity-0", "pointer-events-none");
          setTimeout(() => (modal.style.display = "none"), 600);

          const tourEl = document.querySelector("a-tour");
          const cameraEl = document.querySelector("[camera]");

          // Chuy·ªÉn th·∫≥ng ƒë·∫øn ph√≤ng th·ªù
          if (tourEl && tourEl.components["tour"]) {
            tourEl.components["tour"].loadSceneId("phong_tho");
          }

          // Xoay g√≥c nh√¨n camera
          setTimeout(() => {
            if (cameraEl) cameraEl.setAttribute("rotation", "0 45 0");
          }, 1000);

          // T·∫Øt nh·∫°c n·ªÅn & ph√°t thuy·∫øt minh
          if (currentAudio) currentAudio.pause();
          audioGeneral.pause();

          narrationPlayer.classList.remove("hidden");
          currentAudio = narrationAudio;
          narrationAudio.currentTime = 0;
          if (soundEnabled) narrationAudio.play();

          // ƒê·ªïi icon sang Pause
          narrationIconPlay.classList.add("hidden");
          narrationIconPause.classList.remove("hidden");
        });

        // üîá B·∫≠t / t·∫Øt √¢m thanh n·ªÅn
        soundBtn.addEventListener("click", () => {
          soundEnabled = !soundEnabled;
          soundOn.classList.toggle("hidden", !soundEnabled);
          soundOff.classList.toggle("hidden", soundEnabled);

          if (!soundEnabled) {
            if (currentAudio) currentAudio.pause();
            audioGeneral.pause();
            narrationAudio.pause();
          } else {
            if (currentAudio) currentAudio.play();
            else audioGeneral.play();
          }
        });

        // üéß Khi ƒë·ªïi scene ‚Üí t·ª± ph√°t offvoice n·∫øu l√† ph√≤ng th·ªù
        const tourEl = document.querySelector("a-tour");
        const originalLoadSceneId = tourEl.components["tour"].loadSceneId.bind(
          tourEl.components["tour"]
        );

        tourEl.components["tour"].loadSceneId = function (id) {
          originalLoadSceneId(id);
          handleSceneChange(id);
        };

        function handleSceneChange(id) {
          const isPhongTho = id.includes("phong_tho");

          if (currentAudio) currentAudio.pause();
          audioGeneral.pause();
          narrationAudio.pause();

          if (isPhongTho) {
            narrationPlayer.classList.remove("hidden");
            currentAudio = narrationAudio;
            narrationAudio.currentTime = 0;
            if (soundEnabled) narrationAudio.play();
            narrationIconPlay.classList.add("hidden");
            narrationIconPause.classList.remove("hidden");
          } else {
            narrationPlayer.classList.add("hidden");
            currentAudio = audioGeneral;
            if (soundEnabled) audioGeneral.play();
          }
        }

        // üéôÔ∏è N√∫t b·∫≠t/t·∫Øt thuy·∫øt minh th·ªß c√¥ng
        narrationBtn.addEventListener("click", () => {
          narrationPlayer.classList.remove("hidden");

          if (narrationAudio.paused) {
            if (currentAudio) currentAudio.pause();
            audioGeneral.pause();

            currentAudio = narrationAudio;
            narrationAudio.play();
            narrationIconPlay.classList.add("hidden");
            narrationIconPause.classList.remove("hidden");
          } else {
            narrationAudio.pause();
            narrationIconPlay.classList.remove("hidden");
            narrationIconPause.classList.add("hidden");
          }
        });

        // Khi k·∫øt th√∫c ho·∫∑c pause ‚Üí ƒë·ªìng b·ªô icon
        narrationAudio.addEventListener("ended", () => {
          narrationPlayer.classList.add("hidden");
          narrationIconPlay.classList.remove("hidden");
          narrationIconPause.classList.add("hidden");
        });
        narrationAudio.addEventListener("pause", () => {
          narrationIconPlay.classList.remove("hidden");
          narrationIconPause.classList.add("hidden");
        });
        narrationAudio.addEventListener("play", () => {
          narrationIconPlay.classList.add("hidden");
          narrationIconPause.classList.remove("hidden");
        });

        // ======================= GALLERY SLIDESHOW (GI·ªÆ NGUY√äN) ==========================
        const galleryModal = document.getElementById("gallery-modal");
        const openGalleryBtn = document.getElementById("open-gallery-btn");
        const closeGalleryBtn = document.getElementById("close-gallery-btn");
        const galleryImage = document.getElementById("gallery-image");
        const prevBtn = document.getElementById("prev-image");
        const nextBtn = document.getElementById("next-image");
        const galleryCounter = document.getElementById("gallery-counter");

        const totalImages = 26;
        let currentIndex = 1;

        function updateGallery() {
          galleryImage.src = `assets/image/can_bo/${currentIndex}.jpg`;
          galleryCounter.textContent = `H√¨nh ${currentIndex} / ${totalImages}`;
        }

        openGalleryBtn.addEventListener("click", () => {
          galleryModal.classList.remove("hidden");
          galleryModal.classList.add("flex");
          currentIndex = 1;
          updateGallery();
        });

        closeGalleryBtn.addEventListener("click", () => {
          galleryModal.classList.add("hidden");
        });

        nextBtn.addEventListener("click", () => {
          currentIndex = currentIndex < totalImages ? currentIndex + 1 : 1;
          updateGallery();
        });

        prevBtn.addEventListener("click", () => {
          currentIndex = currentIndex > 1 ? currentIndex - 1 : totalImages;
          updateGallery();
        });

        galleryModal.addEventListener("click", (e) => {
          if (e.target === galleryModal) galleryModal.classList.add("hidden");
        });

        let startX = 0;
        galleryImage.addEventListener(
          "touchstart",
          (e) => (startX = e.touches[0].clientX)
        );
        galleryImage.addEventListener("touchend", (e) => {
          const diff = e.changedTouches[0].clientX - startX;
          if (diff > 50) prevBtn.click();
          if (diff < -50) nextBtn.click();
        });
      });
    </script>
  </body>
</html>
