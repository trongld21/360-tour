<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR Tour Di T√≠ch U Minh</title>
    <meta name="description" content="360&deg; Tour - A-Frame" />

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/js/aframe.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-orbit-controls-component@1.1.0/dist/aframe-orbit-controls-component.min.js"></script>
    <script src="assets/js/tour.js"></script>
    <script src="assets/js/hotspot.js"></script>
    <script src="assets/js/panorama.js"></script>
  </head>
  <body>
    <!-- üåÑ MODAL GI·ªöI THI·ªÜU -->
    <div
      id="intro-modal"
      class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-md transition-all duration-500"
    >
      <!-- Background -->
      <div
        class="absolute inset-0 bg-cover bg-center"
        style="
          background-image: url('assets/image/cong_truoc/home.jpg');
          filter: brightness(0.6);
        "
      ></div>

      <!-- N·ªôi dung -->
      <div
        class="relative z-10 text-center text-white px-6 py-10 md:px-12 lg:px-24 max-w-3xl"
      >
        <h1
          class="text-3xl md:text-4xl font-extrabold mb-6 drop-shadow-lg uppercase tracking-wide"
        >
          AR TOUR DI T√çCH U MINH
        </h1>

        <p class="text-lg md:text-xl mb-4 font-light">
          D·ª± √°n tham quan th·ª±c t·∫ø ·∫£o Di T√≠ch L·ªãch S·ª≠ - VƒÉn H√≥a U Minh, ƒë∆∞·ª£c ph√°t
          tri·ªÉn nh·∫±m mang ƒë·∫øn tr·∫£i nghi·ªám ch√¢n th·ª±c v·ªÅ kh√¥ng gian vƒÉn h√≥a ƒë·ªãa
          ph∆∞∆°ng.
        </p>

        <p class="text-base md:text-lg mb-8 text-gray-300">
          <span class="font-semibold">ƒê∆°n v·ªã th·ª±c hi·ªán:</span> ƒêo√†n Tr∆∞·ªùng THCS
          Ph√∫ Th·ª©
        </p>

        <button
          id="start-tour-btn"
          class="mt-6 bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white text-lg md:text-xl font-semibold py-3 px-8 rounded-full shadow-lg transition-all duration-300"
        >
          üöÄ B·∫Øt ƒë·∫ßu tham quan
        </button>
      </div>
    </div>

    <button
      id="sound-toggle"
      class="fixed top-4 right-4 z-40 bg-black/60 text-white p-3 rounded-full shadow-lg hover:bg-black/80 transition-all duration-300 flex items-center justify-center"
      title="B·∫≠t / T·∫Øt √¢m thanh"
    >
      <svg
        id="sound-icon-on"
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6 block"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 9v6h4l5 5V4l-5 5H9z"
        />
      </svg>
      <svg
        id="sound-icon-off"
        xmlns="http://www.w3.org/2000/svg"
        class="h-6 w-6 hidden"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M9 9v6h4l5 5V4l-5 5H9zM19 5L5 19"
        />
      </svg>
    </button>

    <audio id="audio-phong_tho" src="assets/audio/audio1.mp3" loop></audio>
    <audio id="audio-gian_truoc" src="assets/audio/audio2.mp3" loop></audio>
    <audio
      id="audio-phong_truyen_thong"
      src="assets/audio/audio3.mp3"
      loop
    ></audio>

    <a-scene>
      <a-assets>
        <a-mixin
          id="hotspot-text"
          text="font: exo2bold; width: 5"
          geometry="primitive: plane; width: 1.6; height: 0.4"
          material="color: black;"
          position="0 -0.6 0"
        ></a-mixin>
        <a-mixin
          id="hotspot-target"
          geometry="primitive: octahedron; radius: 0.3;"
          material="flatShading: true; color: rgb(255, 0, 161)"
        ></a-mixin>
      </a-assets>
      <a-tour hotspot-helper="target: #test">
        <!-- Panorama 1 -->
        <!-- id="khleang-pagoda" -->
        <a-panorama
          id="gian_truoc_1"
          src="assets/image/gian_truoc/1.jpg"
          rotation="0 0 0"
        >
        </a-panorama>
        <a-panorama
          id="gian_truoc_2"
          src="assets/image/gian_truoc/2.jpg"
          rotation="0 0 0"
        >
        </a-panorama>
        <a-panorama
          id="gian_truoc_3"
          src="assets/image/gian_truoc/5.jpg"
          rotation="0 0 0"
        >
        </a-panorama>
        <a-panorama
          id="gian_truoc_4"
          src="assets/image/gian_truoc/4.jpg"
          rotation="0 0 0"
        >
        </a-panorama>
        <a-panorama
          id="gian_truoc_5"
          src="assets/image/gian_truoc/3.jpg"
          rotation="0 0 0"
        >
        </a-panorama>
        <a-panorama
          id="gian_truoc_6"
          src="assets/image/gian_truoc/6.jpg"
          rotation="0 0 0"
        >
        </a-panorama>

        <!-- Ph√≤ng truy·ªÅn th·ªëng -->
        <a-panorama
          id="phong_truyen_thong"
          src="assets/image/phong_truyen_thong/1.jpg"
          rotation="0 0 0"
        >
        </a-panorama>

        <!-- Ph√≤ng th·ªù -->
        <a-panorama
          id="phong_tho"
          src="assets/image/gian_tho/1.jpg"
          rotation="0 0 0"
        >
        </a-panorama>

        <a-panorama
          id="phong_tho_2"
          src="assets/image/gian_tho/2.jpg"
          rotation="0 0 0"
        >
        </a-panorama>

        <a-panorama
          id="phong_tho_3"
          src="assets/image/gian_tho/4.jpg"
          rotation="0 0 0"
        >
        </a-panorama>

        <a-panorama
          id="phong_tho_4"
          src="assets/image/gian_tho/5.jpg"
          rotation="0 0 0"
        >
        </a-panorama>

        <!-- Hotspots -->
        <!-- From Panorama 1 to 2 -->
        <a-hotspot
          for="gian_truoc_1"
          to="phong_truyen_thong"
          position="-3 -4 -8"
          rotation="0 20 0"
          visible="true"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 180 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="gian_truoc_1"
          to="gian_truoc_2"
          position="3 -4 8"
          rotation="0 200 0"
          visible="true"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 180 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="gian_truoc_2"
          to="gian_truoc_1"
          position="3 -6 8"
          rotation="0 -175 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 180 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="gian_truoc_2"
          to="gian_truoc_3"
          position="0 -4 -8"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 180 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="gian_truoc_3"
          to="gian_truoc_2"
          position="-1 -4 -8"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 180 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="gian_truoc_2"
          to="phong_tho"
          position="-7 -2 1"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 -90 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_tho"
          to="gian_truoc_2"
          position="10 -3 0"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 90 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_tho"
          to="phong_tho_2"
          position="-5 -5 0"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 -90 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_tho"
          to="phong_tho_3"
          position="0 -5 5"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 0 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_tho_3"
          to="phong_tho"
          position="-2 -5 -5"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 190 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_tho"
          to="phong_tho_4"
          position="0 -5 -5"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 180 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_tho_4"
          to="phong_tho"
          position="0 -5 5"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 0 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_tho_2"
          to="phong_tho"
          position="10 -5 0"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 90 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>

        <a-hotspot
          for="phong_truyen_thong"
          to="gian_truoc_1"
          position="2 -3 -8"
          rotation="0 0 0"
          visible="false"
        >
          <a-image
            src="assets/image/icon/arrow.png"
            width="1"
            height="1"
            look-at="[camera]"
            animation=""
            rotation="90 180 90"
            scale="2 2 2"
          ></a-image>
        </a-hotspot>
      </a-tour>

      <!-- <a-entity
        gltf-model="assets/models/sample.glb"
        position="0 -2 -5"
        scale="1 1 1"
        rotation="0 180 0"
        animation="property: rotation; from: 0 180 0; to: 0 540 0; loop: true; dur: 10000; easing: linear"
      >
      </a-entity> -->

      <a-entity camera look-controls wasd-controls>
        <a-entity
          cursor
          position="0 0 -1"
          geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
          material="color: black; shader: flat"
        >
        </a-entity>
      </a-entity>
    </a-scene>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const modal = document.getElementById("intro-modal");
        const startBtn = document.getElementById("start-tour-btn");
        const soundBtn = document.getElementById("sound-toggle");
        const soundOn = document.getElementById("sound-icon-on");
        const soundOff = document.getElementById("sound-icon-off");

        const audios = {
          phong_tho: document.getElementById("audio-phong_tho"),
          gian_truoc: document.getElementById("audio-gian_truoc"),
          phong_truyen_thong: document.getElementById(
            "audio-phong_truyen_thong"
          ),
        };

        let currentAudio = null;
        let currentGroup = null; // nh√≥m hi·ªán t·∫°i (vd: phong_tho)
        let soundEnabled = true;

        // ·∫®n modal khi b·∫Øt ƒë·∫ßu
        startBtn.addEventListener("click", () => {
          modal.classList.add("opacity-0", "pointer-events-none");
          setTimeout(() => (modal.style.display = "none"), 600);
          playAudio("gian_truoc");
        });

        // B·∫≠t / t·∫Øt √¢m thanh
        soundBtn.addEventListener("click", () => {
          soundEnabled = !soundEnabled;
          soundOn.classList.toggle("hidden", !soundEnabled);
          soundOff.classList.toggle("hidden", soundEnabled);

          if (!soundEnabled && currentAudio) {
            currentAudio.pause();
          } else if (soundEnabled && currentAudio) {
            currentAudio.play();
          }
        });

        // H√†m x√°c ƒë·ªãnh nh√≥m √¢m thanh theo id
        function getGroup(sceneId) {
          if (sceneId.includes("phong_tho")) return "phong_tho";
          if (sceneId.includes("gian_truoc")) return "gian_truoc";
          if (sceneId.includes("phong_truyen_thong"))
            return "phong_truyen_thong";
          return null;
        }

        // H√†m ph√°t √¢m thanh t∆∞∆°ng ·ª©ng
        function playAudio(sceneId) {
          const newGroup = getGroup(sceneId);
          if (!newGroup) return;

          // N·∫øu v·∫´n c√πng nh√≥m => kh√¥ng reset √¢m thanh
          if (
            currentGroup === newGroup &&
            currentAudio &&
            !currentAudio.paused
          ) {
            return;
          }

          // N·∫øu nh√≥m kh√°c => t·∫Øt √¢m thanh c≈© v√† ph√°t nh·∫°c m·ªõi
          if (currentAudio) {
            currentAudio.pause();
          }

          currentGroup = newGroup;
          currentAudio = audios[newGroup];

          if (soundEnabled && currentAudio) {
            currentAudio.play();
          }
        }

        // Hook v√†o component tour (khi ƒë·ªïi c·∫£nh)
        const tourEl = document.querySelector("a-tour");
        const originalLoadSceneId = tourEl.components["tour"].loadSceneId.bind(
          tourEl.components["tour"]
        );

        tourEl.components["tour"].loadSceneId = function (id) {
          originalLoadSceneId(id);
          playAudio(id);
        };
      });
    </script>
  </body>
</html>
